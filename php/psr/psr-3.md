---
title: 日志接口
titleTemplate: PSR 教程
---

# 日志接口

本文制定了日志类库的通用接口规范。

本规范的主要目的，是为了让日志类库以简单通用的方式，通过接收一个日志接口 Psr\Log\LoggerInterface 对象，来记录日志信息。

框架以及 CMS 内容管理系统如有需要，可以 对此接口进行扩展，但需遵循本规范，这才能保证在使用第三方的类库文件时，日志接口仍能正常对接。

本文档中的 `implementor` 一词应理解为在日志的库中实现日志接口 `LoggerInterface` 的人。记录器的调用者称为 `user`

## 1. 规范

### 1.1 基础知识

> `LoggerInterface` 接口对外定义了八个方法，分别用来记录 RFC 5424 中定义的八个等级的日志：

| 级别      | 中文 | 严重程度描述     | code |
| --------- | ---- | ---------------- | ---- |
| emergency | 紧急 | 系统无法使用     | 0    |
| alert     | 警报 | 必须立即采取行动 | 1    |
| critical  | 严重 | 临界条件         | 2    |
| error     | 错误 | 错误条件         | 3    |
| warning   | 警告 | 警告条件         | 4    |
| notice    | 通知 | 正常但重要的条件 | 5    |
| info      | 信息 | 信息性消息       | 6    |
| debug     | 调试 | 调试级消息       | 7    |

::: tip 第九个方法 - log
第 1 个参数为记录的等级。可使用 1 个预先定义的等级常量作为参数来调用此方法， `必须` 与直接调用以上八个方法具有相同的效果。如果传入的等级常量参数没有预先定义，则 `必须` 抛出 `Psr\Log\InvalidArgumentException` 类型的异常。在不确定的情况下，使用者 `不该` 使用未支持的等级常量来调用此方法。
:::

### 1.2 消息

以上每个方法都接受一个字符串类型或者是有 `__toString()` 方法的对象作为记录信息参数，这样，实现者就能把它当成字符串来处理，否则实现者 `必须` 自己把它转换成字符串。

记录信息参数 `可以` 携带占位符，实现者 `可以` 根据上下文数组(`array $context`)将其它替换成相应的值。

其中占位符 `必须` 与上下文数组中的键名保持一致。

占位符的名称 `必须` 由一个左花括号 { 以及一个右括号 } 包含。但花括号与名称之间 一定不可有空格符。

占位符的名称 `应该` 只由 `A-Z`、`a-z`、`0-9`、下划线 `_`、以及英文的句号 `.` 组成，其它字符作为将来占位符规范的保留。

实现者 `可以` 通过对占位符采用不同的转义和转换策略，来生成最终的日志。

而使用者在不知道上下文的前提下，`不该` 提前转义占位符。

以下是一个占位符使用的例子：

<<<@/assets/php/psr/psr-3/01.php

### 1.3 上下文数组

每个记录函数都接受一个上下文数组(`array $context`)参数，用来装载字符串类型无法表示的信息。它 `可以` 装载任何信息，所以实现者 `必须` 确保能正确处理其装载的信息，对于其装载的数据， `一定不可` 抛出异常，或产生 PHP 出错、警告或提醒信息（error、warning、notice）。

如需通过上下文参数传入了一个 `Exception` 对象，必须 以 `exception` 作为键名。

记录异常信息是很普遍的，所以如果它能够在记录类库的底层实现，就能够让实现者从异常信息中抽丝剥茧。

当然，实现者在使用它时，`必须` 确保键名为 `exception` 的键值是否真的是一个 `Exception`，毕竟它 `可以` 装载任何信息。

### 1.4 助手类和接口

-   日志抽象类 `Psr\Log\AbstractLogger` 使得只需继承它和实现其中的 `log` 方法，就能够很轻易地实现日志接口 `LoggerInterface` ，而另外八个方法就能够把记录信息和上下文数组信息传给它。

-   同样地，使用日志特征 `Psr\Log\LoggerTrait` 也只需实现其中的 `log` 方法。不过需要注意的是，PHP 的可复用代码块(特征)不能实现接口，还需要 `implement LoggerInterface` 指令来实现接口。

-   在没有可用的日志记录器时，`Psr\Log\NullLogger` 接口 `可以` 为使用者提供一个备用的日志「黑洞」。不过，当上下文数组的构建非常消耗资源时，带条件检查的日志记录或许是更好的办法。

-   `Psr\Log\LoggerAwareInterface` 接口仅包括一个 `setLogger(LoggerInterface $logger)` 方法，框架可以使用它实现自动连接任意的日志记录实例。

-   `Psr\Log\LoggerAwareTrait` 可复用代码块(特征)可以在任何的类里面使用，只需通过它提供的 `$this->logger` ，就可以轻松地实现等同的接口。

-   `Psr\Log\LogLevel` 类装载了八个记录等级常量。

## 2. Package

接口和类的描述、相关的异常类以及用于验证你所写代码的测试套件都将作为 [psr/log](https://packagist.org/packages/psr/log) 包的一部分提供。

## 3. 日志接口

接口命名空间 `Psr\Log\LoggerInterface`

<<<@/assets/php/psr/psr-3/02.php

## 4. 日志依赖注入接口

接口命名空间 `Psr\Log\LoggerAwareInterface`

<<<@/assets/php/psr/psr-3/03.php

## 5. 日志等级常量

接口命名空间 `Psr\Log\LogLevel`

<<<@/assets/php/psr/psr-3/03.php
